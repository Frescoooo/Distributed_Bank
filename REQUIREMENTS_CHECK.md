# 项目要求检查报告 (Requirements Check Report)

## 项目要求对照分析

根据 `Course.Project.for2025b.pdf` 的要求，以下是详细检查结果：

---

## ✅ 已满足的要求

### 1. 基本架构要求

#### 1.1 UDP Socket 通信
- **要求**: 使用UDP（非TCP）socket进行通信
- **实现状态**: ✅ **已满足**
- **证据**:
  - `Server.java`: 使用 `DatagramSocket` 和 `DatagramPacket`
  - `Cli.java`: 使用 `DatagramSocket` 进行UDP通信
  - `client.cpp`: 使用 `SOCK_DGRAM` 和 `IPPROTO_UDP`

#### 1.2 客户端-服务器架构
- **要求**: 客户端发送请求，服务器处理并返回结果
- **实现状态**: ✅ **已满足**
- **证据**: 完整的请求-响应机制已实现

---

### 2. 银行账户数据结构

#### 2.1 账户属性
- **要求**: 
  - account number (integer) ✅
  - name of account holder (variable-length string) ✅
  - password (fixed-length string) ✅
  - currency type (enumerated type) ✅
  - account balance (floating-point value) ✅
- **实现状态**: ✅ **已满足**
- **证据**: `Bank.java` 中的 `Account` 类包含所有必需字段

---

### 3. 必需的服务实现

#### 3.1 开户服务 (Open Account)
- **要求**: 允许用户通过指定姓名、密码、货币类型和初始余额创建新账户，返回账户号
- **实现状态**: ✅ **已满足**
- **证据**: 
  - `Server.java`: `handleOpen()` 方法
  - `Bank.java`: `openAccount()` 方法
  - 客户端支持完整的开户流程

#### 3.2 关闭账户服务 (Close Account)
- **要求**: 允许用户通过指定姓名、账户号和密码关闭账户，返回确认消息或错误
- **实现状态**: ✅ **已满足**
- **证据**:
  - `Server.java`: `handleClose()` 方法
  - `Bank.java`: `closeAccount()` 方法
  - 包含完整的错误处理（密码错误、账户不存在等）

#### 3.3 存款服务 (Deposit)
- **要求**: 允许用户存款，指定姓名、账户号、密码、货币类型和金额，返回更新后的余额
- **实现状态**: ✅ **已满足**
- **证据**:
  - `Server.java`: `handleDeposit()` 方法
  - `Bank.java`: `deposit()` 方法
  - 包含错误处理（余额不足、货币不匹配等）

#### 3.4 取款服务 (Withdraw)
- **要求**: 允许用户取款，指定姓名、账户号、密码、货币类型和金额，返回更新后的余额
- **实现状态**: ✅ **已满足**
- **证据**:
  - `Server.java`: `handleWithdraw()` 方法
  - `Bank.java`: `withdraw()` 方法
  - 包含错误处理（余额不足、货币不匹配等）

#### 3.5 监控服务 (Monitor with Callback)
- **要求**: 
  - 允许用户注册监控，指定监控时间间隔
  - 服务器记录客户端地址和端口
  - 在监控期间，任何账户更新都会通过回调发送给注册的客户端
  - 监控时间到期后自动移除客户端记录
  - 支持多个客户端同时监控
- **实现状态**: ✅ **已满足**
- **证据**:
  - `Server.java`: `handleMonitorRegister()` 和 `sendUpdateCallback()` 方法
  - `MonitorEntry` 类管理监控注册
  - 客户端在监控期间阻塞等待回调（符合要求：用户被阻塞直到监控结束）
  - 支持多客户端并发监控

---

### 4. 额外操作（两个）

#### 4.1 幂等操作
- **要求**: 实现一个幂等操作
- **实现状态**: ✅ **已满足**
- **操作**: `QUERY_BALANCE` (查询余额)
- **证据**:
  - `Server.java`: `handleQueryBalance()` 方法
  - `Bank.java`: `queryBalance()` 方法
  - 查询操作是幂等的（多次查询不影响账户状态）

#### 4.2 非幂等操作
- **要求**: 实现一个非幂等操作
- **实现状态**: ✅ **已满足**
- **操作**: `TRANSFER` (转账)
- **证据**:
  - `Server.java`: `handleTransfer()` 方法
  - `Bank.java`: `transfer()` 方法
  - 转账操作是非幂等的（重复执行会导致多次转账）

---

### 5. Marshalling/Unmarshalling

#### 5.1 自定义序列化
- **要求**: 
  - 不使用RMI、RPC、CORBA、Java对象序列化或输入/输出流类
  - 使用字节数组存储marshalled数据
  - 实现整数、浮点数、枚举、字符串等的marshalling/unmarshalling
  - 字符串需要包含长度信息（因为长度可变）
- **实现状态**: ✅ **已满足**
- **证据**:
  - `Protocol.java`: 完全自定义的 `encode()` 和 `decode()` 方法
  - 使用 `ByteBuffer` 进行字节级操作（不使用Java序列化）
  - `putString()` / `getString()`: 字符串带2字节长度前缀
  - `putPassword16()` / `getPassword16()`: 固定16字节密码
  - 所有多字节数据使用大端序（网络字节序）

#### 5.2 网络字节序
- **要求**: 使用网络字节序（大端序）
- **实现状态**: ✅ **已满足**
- **证据**: `ByteBuffer.order(ByteOrder.BIG_ENDIAN)` 在所有编码/解码中使用

---

### 6. 调用语义 (Invocation Semantics)

#### 6.1 At-Least-Once 语义
- **要求**: 实现at-least-once调用语义
- **实现状态**: ✅ **已满足**
- **实现方式**:
  - 客户端超时重传机制
  - 服务器不过滤重复请求
- **证据**:
  - `Cli.java`: `call()` 方法中的重试循环
  - `Server.java`: 当 `FLAG_AT_MOST_ONCE` 未设置时，不进行去重

#### 6.2 At-Most-Once 语义
- **要求**: 实现at-most-once调用语义
- **实现状态**: ✅ **已满足**
- **实现方式**:
  - 每个请求带唯一requestId
  - 服务器维护请求历史记录（去重缓存）
  - 重复请求返回缓存的响应
- **证据**:
  - `Server.java`: `DedupEntry` 类和 `dedupCache` 映射
  - 服务器检查重复请求并返回缓存响应
  - 客户端通过 `--sem atmost` 参数启用

#### 6.3 语义选择
- **要求**: 可以通过命令行参数选择调用语义
- **实现状态**: ✅ **已满足**
- **证据**: 
  - `Main.java`: `--sem atmost|atleast` 参数
  - `Server.java`: 根据 `FLAG_AT_MOST_ONCE` 标志决定是否去重

---

### 7. 消息丢失模拟

#### 7.1 模拟请求/响应丢失
- **要求**: 在程序中模拟请求和响应消息的丢失，用于测试
- **实现状态**: ✅ **已满足**
- **证据**:
  - `Server.java`: `lossReq` 和 `lossRep` 参数
  - 使用随机数模拟消息丢失概率
  - 可通过 `--lossReq` 和 `--lossRep` 命令行参数配置

---

### 8. 实验和验证

#### 8.1 实验设计
- **要求**: 设计实验比较两种调用语义，证明at-least-once对非幂等操作会导致错误结果
- **实现状态**: ⚠️ **部分满足**（代码已实现，但需要文档说明实验过程）
- **建议**: 在报告中详细描述实验步骤和结果

---

### 9. 客户端接口

#### 9.1 文本界面
- **要求**: 提供文本控制台界面，用户可输入请求
- **实现状态**: ✅ **已满足**
- **证据**: 
  - `Cli.java`: 完整的菜单驱动界面
  - 所有操作都有用户友好的提示

#### 9.2 错误显示
- **要求**: 服务器返回的错误消息应显示在屏幕上
- **实现状态**: ✅ **已满足**
- **证据**: 客户端显示所有错误状态码和消息

#### 9.3 退出选项
- **要求**: 提供终止客户端的选项
- **实现状态**: ✅ **已满足**
- **证据**: 菜单选项 "0) EXIT"

---

### 10. 服务器功能

#### 10.1 请求处理
- **要求**: 服务器接收请求、处理服务并回复
- **实现状态**: ✅ **已满足**
- **证据**: `Server.java` 的主循环

#### 10.2 日志输出
- **要求**: 接收的请求和产生的响应应打印到屏幕
- **实现状态**: ✅ **已满足**
- **证据**: 服务器输出详细的日志信息

#### 10.3 数据存储
- **要求**: 账户信息存储在内存中（持久化存储不是必需的）
- **实现状态**: ✅ **已满足**
- **证据**: `Bank.java` 使用 `ConcurrentHashMap` 在内存中存储账户

---

### 11. 跨语言支持（可选）

#### 11.1 不同语言实现
- **要求**: （可选）客户端和服务器使用不同编程语言实现
- **实现状态**: ✅ **已满足**（额外实现）
- **证据**:
  - 服务器: Java
  - 客户端: Java 和 C++
  - 协议兼容，可互操作

---

## ⚠️ 需要注意的事项

### 1. 报告要求
- **要求**: 在报告中清楚解释设计和实现策略
- **状态**: ⚠️ **需要确认**
- **建议**: 确保报告包含：
  - 请求/响应消息格式设计说明
  - 两种调用语义的实现细节
  - 实验设计和结果分析
  - 两个额外操作的设计说明（幂等和非幂等）

### 2. 实验验证
- **要求**: 通过实验证明at-least-once对非幂等操作的问题
- **状态**: ⚠️ **需要文档化**
- **建议**: 在报告中包含：
  - 实验步骤
  - 测试场景（启用消息丢失）
  - 观察结果
  - 对比分析

### 3. 代码注释
- **要求**: 提交良好注释的源代码
- **状态**: ✅ **已满足**
- **证据**: 代码中包含详细的注释

---

## 📊 总体评估

### 满足度统计
- **核心要求**: 100% ✅
- **可选要求**: 100% ✅（跨语言支持）
- **文档要求**: 需要确认报告内容

### 总结
项目**完全满足**PDF中的所有核心要求：
1. ✅ UDP通信
2. ✅ 所有必需服务（开户、关户、存款、取款、监控）
3. ✅ 两个额外操作（查询余额-幂等，转账-非幂等）
4. ✅ 自定义marshalling/unmarshalling
5. ✅ 两种调用语义（at-least-once和at-most-once）
6. ✅ 消息丢失模拟
7. ✅ 完整的客户端界面
8. ✅ 服务器日志和错误处理
9. ✅ 跨语言支持（额外）

### 建议
1. **报告撰写**: 确保报告详细说明设计决策和实验过程
2. **实验文档**: 在报告中包含详细的实验步骤和结果
3. **演示准备**: 准备演示脚本，展示两种调用语义的差异

---

## 详细检查清单

- [x] UDP socket通信
- [x] 账户数据结构（accountNo, name, password, currency, balance）
- [x] 开户服务
- [x] 关闭账户服务
- [x] 存款服务
- [x] 取款服务
- [x] 监控服务（callback）
- [x] 幂等操作（查询余额）
- [x] 非幂等操作（转账）
- [x] 自定义marshalling/unmarshalling
- [x] 不使用Java序列化
- [x] 网络字节序
- [x] At-least-once语义
- [x] At-most-once语义
- [x] 请求ID机制
- [x] 服务器去重缓存
- [x] 消息丢失模拟
- [x] 客户端文本界面
- [x] 错误消息显示
- [x] 退出选项
- [x] 服务器日志
- [x] 内存数据存储
- [x] 代码注释
- [ ] 实验报告（需要确认）
- [ ] 设计说明文档（需要确认）

---

**最后更新**: 2025-01-XX
**检查人**: AI Assistant